<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Blog Articles - Adhirat Portal</title>
    <meta name="robots" content="noindex, nofollow">
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <script src="../assets/js/app.js"></script>
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <style>
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
        }

        .ql-toolbar.ql-snow {
            border: none !important;
            background: rgba(148, 163, 184, 0.1);
            border-radius: 12px 12px 0 0;
            padding: 12px !important;
        }

        .dark .ql-toolbar.ql-snow {
            background: rgba(30, 41, 59, 0.8);
        }

        .ql-container.ql-snow {
            border: none !important;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
        }

        .ql-editor {
            min-height: 350px;
            padding: 24px !important;
            color: #1e293b;
            line-height: 1.8;
        }

        .dark .ql-editor {
            color: #e2e8f0;
        }

        .ql-editor.ql-blank::before {
            color: #94a3b8;
            font-style: normal !important;
        }

        .ql-toolbar .ql-stroke {
            stroke: #64748b !important;
        }

        .dark .ql-toolbar .ql-stroke {
            stroke: #94a3b8 !important;
        }

        .ql-toolbar .ql-fill {
            fill: #64748b !important;
        }

        .dark .ql-toolbar .ql-fill {
            fill: #94a3b8 !important;
        }

        .ql-toolbar .ql-picker-label {
            color: #64748b !important;
        }

        .dark .ql-toolbar .ql-picker-label {
            color: #94a3b8 !important;
        }

        .ql-toolbar button:hover .ql-stroke,
        .ql-toolbar button.ql-active .ql-stroke {
            stroke: var(--primary) !important;
        }

        .ql-picker-options {
            background: white !important;
            border: 1px solid #e2e8f0 !important;
            border-radius: 8px !important;
        }

        .dark .ql-picker-options {
            background: #1e293b !important;
            border-color: #334155 !important;
        }

        .article-card {
            transition: all 0.3s ease;
        }

        .article-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .stats-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .dark .stats-card {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(0, 245, 255, 0.2);
        }

        .category-badge {
            transition: all 0.2s ease;
        }

        .category-badge:hover {
            transform: scale(1.05);
        }

        /* Template Selection Styles */
        .template-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .template-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }

        .template-card.selected {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
            border-color: var(--primary);
        }

        .template-preview {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            overflow: hidden;
        }

        .dark .template-preview {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        .template-preview-content {
            font-size: 6px;
            line-height: 1.4;
            transform: scale(0.5);
            transform-origin: top left;
            width: 200%;
            height: 200%;
        }
    </style>
</head>

<body
    class="pt-0 bg-background-light dark:bg-dark-bg text-slate-900 dark:text-white font-display antialiased overflow-hidden">
    <div class="flex h-screen w-full overflow-hidden">
        <div id="portal-sidebar" class="contents"></div>
        <main class="flex-1 flex flex-col min-w-0">
            <div id="portal-header" class="contents"></div>
            <div class="flex-1 overflow-y-auto p-4 sm:p-8 animate-fade-in-up">
                <div class="max-w-[1400px] mx-auto flex flex-col gap-8">
                    <!-- Header -->
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                        <div>
                            <h1 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white">Blog Articles
                            </h1>
                            <p class="text-slate-500 dark:text-slate-400">Create and manage blog posts for your website.
                            </p>
                        </div>
                        <button onclick="openTemplateModal()"
                            class="px-6 py-3 rounded-xl bg-primary text-white font-bold flex items-center gap-2 hover:bg-blue-600 transition-all shadow-lg shadow-primary/25 group">
                            <span
                                class="material-symbols-outlined text-xl group-hover:rotate-12 transition-transform">edit_note</span>
                            Write Article
                        </button>
                    </div>

                    <!-- Stats -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="stats-card rounded-xl p-5 hover:scale-[1.02] transition-all">
                            <div class="flex items-center gap-4">
                                <div class="size-12 rounded-xl bg-primary/20 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-2xl text-primary">article</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-slate-900 dark:text-white" id="stats-total">0</p>
                                    <p class="text-sm text-slate-500">Total Articles</p>
                                </div>
                            </div>
                        </div>
                        <div class="stats-card rounded-xl p-5 hover:scale-[1.02] transition-all">
                            <div class="flex items-center gap-4">
                                <div class="size-12 rounded-xl bg-green-500/20 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-2xl text-green-500">public</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-slate-900 dark:text-white" id="stats-published">0
                                    </p>
                                    <p class="text-sm text-slate-500">Published</p>
                                </div>
                            </div>
                        </div>
                        <div class="stats-card rounded-xl p-5 hover:scale-[1.02] transition-all">
                            <div class="flex items-center gap-4">
                                <div class="size-12 rounded-xl bg-amber-500/20 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-2xl text-amber-500">edit</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-slate-900 dark:text-white" id="stats-drafts">0</p>
                                    <p class="text-sm text-slate-500">Drafts</p>
                                </div>
                            </div>
                        </div>
                        <div class="stats-card rounded-xl p-5 hover:scale-[1.02] transition-all">
                            <div class="flex items-center gap-4">
                                <div class="size-12 rounded-xl bg-purple-500/20 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-2xl text-purple-500">visibility</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-slate-900 dark:text-white" id="stats-views">0</p>
                                    <p class="text-sm text-slate-500">Total Views</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="flex flex-wrap gap-3">
                        <input type="text" id="search-input" placeholder="Search articles..." onkeyup="searchArticles()"
                            class="pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-primary w-64">
                        <select id="category-filter" onchange="filterArticles()"
                            class="px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm">
                            <option value="all">All Categories</option>
                            <option value="Technology">Technology</option>
                            <option value="Company">Company</option>
                            <option value="Industry">Industry</option>
                            <option value="Tutorials">Tutorials</option>
                        </select>
                        <select id="status-filter" onchange="filterArticles()"
                            class="px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm">
                            <option value="all">All Status</option>
                            <option value="published">Published</option>
                            <option value="draft">Drafts</option>
                        </select>
                    </div>

                    <!-- Articles Grid -->
                    <div id="articles-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="col-span-full py-12 text-center">
                            <div
                                class="size-8 mx-auto border-2 border-primary border-t-transparent rounded-full animate-spin">
                            </div>
                            <p class="text-slate-500 mt-3">Loading articles...</p>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div id="empty-state" class="hidden text-center py-16">
                        <div
                            class="size-20 mx-auto mb-4 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center">
                            <span class="material-symbols-outlined text-4xl text-slate-400">article</span>
                        </div>
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-2">No articles yet</h3>
                        <p class="text-slate-500 mb-6">Start creating content for your blog.</p>
                        <button onclick="openTemplateModal()"
                            class="px-6 py-3 rounded-xl bg-primary text-white font-semibold hover:bg-blue-600">Write
                            Your First Article</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Compose Modal -->
    <div id="compose-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0" onclick="closeComposeModal()"></div>
        <div
            class="relative bg-white dark:bg-dark-card rounded-2xl shadow-2xl w-full max-w-5xl border border-slate-200 dark:border-slate-700 animate-fade-in-up flex flex-col max-h-[95vh]">
            <div
                class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center flex-shrink-0">
                <div>
                    <h2 id="modal-title" class="text-xl font-bold text-slate-900 dark:text-white">Write New Article</h2>
                    <p class="text-sm text-slate-500 mt-1">Create engaging content with the rich text editor</p>
                </div>
                <button onclick="closeComposeModal()"
                    class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl"><span
                        class="material-symbols-outlined">close</span></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <form id="article-form" class="space-y-6">
                    <input type="hidden" id="article-id" value="">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Article
                            Title</label>
                        <input type="text" id="article-title" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-xl font-bold focus:ring-2 focus:ring-primary"
                            placeholder="Enter a compelling title...">
                    </div>
                    <div>
                        <label
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Excerpt</label>
                        <textarea id="article-excerpt" rows="2"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary"
                            placeholder="Brief summary for previews..."></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label
                                class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Category</label>
                            <select id="article-category"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                                <option value="Technology">Technology</option>
                                <option value="Company">Company News</option>
                                <option value="Industry">Industry Insights</option>
                                <option value="Tutorials">Tutorials</option>
                            </select>
                        </div>
                        <div>
                            <label
                                class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Author</label>
                            <input type="text" id="article-author"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900"
                                placeholder="Author name">
                        </div>
                        <div>
                            <label
                                class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Tags</label>
                            <input type="text" id="article-tags"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900"
                                placeholder="AI, Cloud, SaaS">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Featured
                            Image URL</label>
                        <input type="url" id="article-image"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900"
                            placeholder="https://...">
                    </div>
                    <div>
                        <label
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Content</label>
                        <div
                            class="rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden bg-white dark:bg-slate-900">
                            <div id="editor-container"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div
                class="p-6 border-t border-slate-200 dark:border-slate-700 flex flex-wrap justify-end gap-3 flex-shrink-0 bg-slate-50/50 dark:bg-slate-900/50">
                <button onclick="closeComposeModal()"
                    class="px-5 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-800">Cancel</button>
                <button onclick="saveArticle('draft')"
                    class="px-5 py-2.5 rounded-xl bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-white hover:bg-slate-300 dark:hover:bg-slate-600 font-medium">Save
                    Draft</button>
                <button onclick="saveArticle('published')"
                    class="px-6 py-2.5 rounded-xl bg-primary text-white hover:bg-blue-600 shadow-lg shadow-primary/25 font-semibold flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">public</span>Publish
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="delete-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0" onclick="closeDeleteModal()"></div>
        <div
            class="relative bg-white dark:bg-dark-card rounded-2xl shadow-2xl max-w-md w-full border border-slate-200 dark:border-slate-700 animate-fade-in-up p-6 text-center">
            <div
                class="size-16 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                <span class="material-symbols-outlined text-3xl text-red-500">delete</span>
            </div>
            <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Delete Article?</h3>
            <p class="text-slate-500 mb-6">This action cannot be undone.</p>
            <div class="flex justify-center gap-3">
                <button onclick="closeDeleteModal()"
                    class="px-5 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-800">Cancel</button>
                <button onclick="confirmDelete()"
                    class="px-5 py-2.5 rounded-xl bg-red-500 text-white hover:bg-red-600 font-medium">Delete</button>
            </div>
        </div>
    </div>

    <!-- Template Selection Modal -->
    <div id="template-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0" onclick="closeTemplateModal()"></div>
        <div
            class="relative bg-white dark:bg-dark-card rounded-2xl shadow-2xl w-full max-w-5xl border border-slate-200 dark:border-slate-700 animate-fade-in-up flex flex-col max-h-[90vh]">
            <div
                class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center flex-shrink-0">
                <div>
                    <h2 class="text-xl font-bold text-slate-900 dark:text-white">Choose a Template</h2>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Start with a professionally designed
                        template or write from scratch</p>
                </div>
                <button onclick="closeTemplateModal()"
                    class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="template-grid"></div>
            </div>
            <div
                class="p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center flex-shrink-0 bg-slate-50/50 dark:bg-slate-900/50">
                <button onclick="previewSelectedTemplate()"
                    class="px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors flex items-center gap-2"
                    id="preview-template-btn" disabled>
                    <span class="material-symbols-outlined text-lg">visibility</span>
                    Preview Template
                </button>
                <div class="flex items-center gap-3">
                    <button onclick="closeTemplateModal()"
                        class="px-5 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                        Cancel
                    </button>
                    <button onclick="useSelectedTemplate()"
                        class="px-6 py-2.5 rounded-xl bg-primary text-white hover:bg-blue-600 shadow-lg shadow-primary/25 transition-all font-semibold flex items-center gap-2"
                        id="use-template-btn" disabled>
                        <span class="material-symbols-outlined text-lg">check</span>
                        Use Template
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Preview Modal -->
    <div id="template-preview-modal" class="hidden fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0" onclick="closeTemplatePreview()"></div>
        <div
            class="relative bg-white dark:bg-dark-card rounded-2xl shadow-2xl w-full max-w-3xl border border-slate-200 dark:border-slate-700 animate-fade-in-up flex flex-col max-h-[90vh]">
            <div
                class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold text-slate-900 dark:text-white" id="template-preview-title">Template
                    Preview</h2>
                <button onclick="closeTemplatePreview()"
                    class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div class="bg-slate-50 dark:bg-slate-900 rounded-xl p-8 border border-slate-200 dark:border-slate-700">
                    <div class="max-w-2xl mx-auto" id="template-preview-content"></div>
                </div>
            </div>
            <div
                class="p-6 border-t border-slate-200 dark:border-slate-700 flex justify-end gap-3 flex-shrink-0 bg-slate-50/50 dark:bg-slate-900/50">
                <button onclick="closeTemplatePreview()"
                    class="px-5 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                    Back to Templates
                </button>
                <button onclick="useTemplateFromPreview()"
                    class="px-6 py-2.5 rounded-xl bg-primary text-white hover:bg-blue-600 shadow-lg shadow-primary/25 transition-all font-semibold">
                    Use This Template
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="fixed bottom-8 right-8 transform translate-y-20 opacity-0 transition-all duration-300 z-[100]">
        <div
            class="flex items-center gap-3 px-5 py-4 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-2xl">
            <span id="toast-icon" class="material-symbols-outlined"></span>
            <span id="toast-message" class="font-medium"></span>
        </div>
    </div>

    <script type="module">
        import { db, collection, addDoc, doc, getDoc, getDocs, deleteDoc, updateDoc, query, orderBy, serverTimestamp } from '../assets/js/firebase-config.js';
        import { initAuthObserver } from '../assets/js/firebase-modules.js';
        initAuthObserver(true);

        let quill, articles = [], deleteId = null;
        const categoryColors = { Technology: 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400', Company: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400', Industry: 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400', Tutorials: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' };

        function initEditor() {
            quill = new Quill('#editor-container', {
                theme: 'snow',
                modules: { toolbar: [[{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline', 'strike'], [{ 'color': [] }, { 'background': [] }], [{ 'list': 'ordered' }, { 'list': 'bullet' }], [{ 'align': [] }], ['link', 'image', 'video'], ['blockquote', 'code-block'], ['clean']] },
                placeholder: 'Write your article content here...'
            });
        }

        async function loadArticles() {
            try {
                const q = query(collection(db, "articles"), orderBy("createdAt", "desc"));
                const snapshot = await getDocs(q);
                articles = [];
                snapshot.forEach(doc => articles.push({ id: doc.id, ...doc.data() }));
                renderArticles(articles);
                updateStats();
            } catch (e) { console.error(e); showToast('Error loading articles', 'error'); }
        }

        function renderArticles(data) {
            const grid = document.getElementById('articles-grid');
            const empty = document.getElementById('empty-state');
            if (data.length === 0) { grid.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            grid.innerHTML = data.map(a => {
                const date = a.createdAt?.toDate ? new Date(a.createdAt.toDate()).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '-';
                const color = categoryColors[a.category] || categoryColors.Technology;
                const status = a.status === 'published' ? '<span class="size-2 rounded-full bg-green-500"></span> Published' : '<span class="size-2 rounded-full bg-amber-500"></span> Draft';
                return `<div class="article-card bg-white dark:bg-dark-card rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden">
                    <div class="aspect-video bg-slate-100 dark:bg-slate-800 relative overflow-hidden">
                        ${a.imageUrl ? `<img src="${a.imageUrl}" class="w-full h-full object-cover" alt="">` : `<div class="flex items-center justify-center h-full"><span class="material-symbols-outlined text-5xl text-slate-300">article</span></div>`}
                        <span class="absolute top-3 left-3 px-3 py-1 rounded-full text-xs font-semibold ${color} category-badge">${a.category || 'Uncategorized'}</span>
                    </div>
                    <div class="p-5">
                        <div class="flex items-center gap-2 text-xs text-slate-500 mb-2">${status} <span class="mx-1">â€¢</span> ${date}</div>
                        <h3 class="font-bold text-lg text-slate-900 dark:text-white mb-2 line-clamp-2">${a.title || 'Untitled'}</h3>
                        <p class="text-sm text-slate-500 line-clamp-2 mb-4">${a.excerpt || ''}</p>
                        <div class="flex items-center justify-between pt-4 border-t border-slate-100 dark:border-slate-700">
                            <span class="text-sm text-slate-500">${a.author || 'Unknown'}</span>
                            <div class="flex gap-1">
                                <button onclick="editArticle('${a.id}')" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg text-slate-500 hover:text-primary"><span class="material-symbols-outlined text-[20px]">edit</span></button>
                                <button onclick="openDeleteModal('${a.id}')" class="p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-slate-500 hover:text-red-500"><span class="material-symbols-outlined text-[20px]">delete</span></button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function updateStats() {
            document.getElementById('stats-total').textContent = articles.length;
            document.getElementById('stats-published').textContent = articles.filter(a => a.status === 'published').length;
            document.getElementById('stats-drafts').textContent = articles.filter(a => a.status === 'draft').length;
            document.getElementById('stats-views').textContent = articles.reduce((s, a) => s + (a.views || 0), 0);
        }

        window.saveArticle = async function (status) {
            const title = document.getElementById('article-title').value;
            if (!title.trim()) { showToast('Please enter a title', 'error'); return; }
            const data = { title, excerpt: document.getElementById('article-excerpt').value, category: document.getElementById('article-category').value, author: document.getElementById('article-author').value, tags: document.getElementById('article-tags').value, imageUrl: document.getElementById('article-image').value, content: quill.root.innerHTML, status, updatedAt: serverTimestamp() };
            const id = document.getElementById('article-id').value;
            try {
                if (id) await updateDoc(doc(db, "articles", id), data);
                else { data.createdAt = serverTimestamp(); data.views = 0; await addDoc(collection(db, "articles"), data); }
                showToast(status === 'published' ? 'Article published!' : 'Draft saved!', 'success');
                closeComposeModal(); loadArticles();
            } catch (e) { console.error(e); showToast('Error saving article', 'error'); }
        };

        window.editArticle = async function (id) {
            try {
                const snap = await getDoc(doc(db, "articles", id));
                if (snap.exists()) {
                    const d = snap.data();
                    document.getElementById('article-id').value = id;
                    document.getElementById('article-title').value = d.title || '';
                    document.getElementById('article-excerpt').value = d.excerpt || '';
                    document.getElementById('article-category').value = d.category || 'Technology';
                    document.getElementById('article-author').value = d.author || '';
                    document.getElementById('article-tags').value = d.tags || '';
                    document.getElementById('article-image').value = d.imageUrl || '';
                    quill.root.innerHTML = d.content || '';
                    document.getElementById('modal-title').textContent = 'Edit Article';
                    openComposeModal(true);
                }
            } catch (e) { console.error(e); showToast('Error loading article', 'error'); }
        };

        window.openDeleteModal = id => { deleteId = id; document.getElementById('delete-modal').classList.remove('hidden'); };
        window.closeDeleteModal = () => { deleteId = null; document.getElementById('delete-modal').classList.add('hidden'); };
        window.confirmDelete = async () => { if (!deleteId) return; try { await deleteDoc(doc(db, "articles", deleteId)); showToast('Article deleted', 'success'); closeDeleteModal(); loadArticles(); } catch (e) { showToast('Error', 'error'); } };
        window.openComposeModal = (isEdit = false) => { if (!isEdit) { document.getElementById('article-form').reset(); document.getElementById('article-id').value = ''; document.getElementById('modal-title').textContent = 'Write New Article'; quill.root.innerHTML = ''; } document.getElementById('compose-modal').classList.remove('hidden'); };
        window.closeComposeModal = () => document.getElementById('compose-modal').classList.add('hidden');
        window.searchArticles = () => { const q = document.getElementById('search-input').value.toLowerCase(); renderArticles(articles.filter(a => (a.title || '').toLowerCase().includes(q) || (a.excerpt || '').toLowerCase().includes(q))); };
        window.filterArticles = () => { const cat = document.getElementById('category-filter').value; const st = document.getElementById('status-filter').value; renderArticles(articles.filter(a => (cat === 'all' || a.category === cat) && (st === 'all' || a.status === st))); };

        // Article Templates
        const articleTemplates = [
            {
                id: 'blank',
                name: 'Blank Template',
                description: 'Start from scratch with a clean slate',
                icon: 'add',
                iconBg: 'bg-slate-500/20',
                iconColor: 'text-slate-500',
                title: '',
                excerpt: '',
                category: 'Technology',
                content: ''
            },
            {
                id: 'how-to',
                name: 'How-To Tutorial',
                description: 'Step-by-step guide for your readers',
                icon: 'school',
                iconBg: 'bg-blue-500/20',
                iconColor: 'text-blue-500',
                title: 'How to [Accomplish Goal] in [Timeframe]',
                excerpt: 'Learn the step-by-step process to achieve amazing results with our comprehensive guide.',
                category: 'Tutorials',
                content: `
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        In this comprehensive tutorial, you'll learn everything you need to know about [topic]. Whether you're a complete beginner or looking to refine your skills, this guide has you covered.
                    </p>
                    
                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">What You'll Need</h2>
                    <ul style="color: #475569; font-size: 16px; line-height: 2; padding-left: 24px;">
                        <li>Prerequisite item 1</li>
                        <li>Prerequisite item 2</li>
                        <li>Basic knowledge of [related topic]</li>
                    </ul>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">Step 1: Getting Started</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        Begin by [first action]. This foundation is crucial because [reason]. Make sure to [important tip] before moving on.
                    </p>
                    <div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 16px 20px; border-radius: 0 12px 12px 0; margin: 20px 0;">
                        <p style="color: #0369a1; margin: 0; font-size: 15px;"><strong>ðŸ’¡ Pro Tip:</strong> This is an important insight that will save time.</p>
                    </div>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">Step 2: Core Implementation</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        Now that you have the basics set up, it's time to [main action]. This step involves [description of process].
                    </p>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">Step 3: Final Touches</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        Complete your implementation by [final steps]. Don't forget to [important final action].
                    </p>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">Conclusion</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        Congratulations! You've successfully learned how to [accomplishment]. Continue practicing and exploring [related topics] to deepen your understanding.
                    </p>
                `
            },
            {
                id: 'case-study',
                name: 'Case Study',
                description: 'Showcase client success stories',
                icon: 'trending_up',
                iconBg: 'bg-emerald-500/20',
                iconColor: 'text-emerald-500',
                title: 'How [Client/Company] Achieved [Result] with [Solution]',
                excerpt: 'Discover how our innovative approach helped transform business outcomes and drive measurable success.',
                category: 'Company',
                content: `
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        When [Client Name] approached us, they were facing a significant challenge: [describe the problem]. In this case study, we'll explore how our partnership led to remarkable results.
                    </p>

                    <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 24px; border-radius: 16px; margin: 24px 0;">
                        <h3 style="color: #166534; margin: 0 0 12px 0; font-size: 18px;">ðŸ“Š Key Results</h3>
                        <ul style="color: #15803d; font-size: 15px; line-height: 2; padding-left: 20px; margin: 0;">
                            <li><strong>150%</strong> increase in [metric]</li>
                            <li><strong>50%</strong> reduction in [pain point]</li>
                            <li><strong>3x</strong> improvement in [outcome]</li>
                        </ul>
                    </div>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">The Challenge</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        [Client Name] is a [industry] company that [brief description]. They were struggling with [specific challenges] which was impacting [business outcomes].
                    </p>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">Our Solution</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        We developed a comprehensive strategy that included:
                    </p>
                    <ol style="color: #475569; font-size: 16px; line-height: 2; padding-left: 24px;">
                        <li>First strategic approach</li>
                        <li>Second implementation detail</li>
                        <li>Third key component</li>
                    </ol>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">The Results</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        After implementing our solution, [Client Name] experienced transformative results. [Detailed description of the positive outcomes and impact].
                    </p>

                    <blockquote style="border-left: 4px solid #10b981; padding: 16px 24px; margin: 24px 0; background: #f8fafc; border-radius: 0 12px 12px 0;">
                        <p style="font-size: 18px; font-style: italic; color: #334155; margin: 0 0 12px 0;">"[Testimonial quote from the client about their experience and results]"</p>
                        <footer style="color: #64748b; font-size: 14px;">â€” Client Name, Title at Company</footer>
                    </blockquote>
                `
            },
            {
                id: 'product-feature',
                name: 'Product Feature',
                description: 'Highlight new features and updates',
                icon: 'new_releases',
                iconBg: 'bg-purple-500/20',
                iconColor: 'text-purple-500',
                title: 'Introducing [Feature Name]: [Brief Value Proposition]',
                excerpt: 'We\'re excited to announce a powerful new feature that will transform how you work.',
                category: 'Technology',
                content: `
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        We're thrilled to announce the launch of [Feature Name], a game-changing addition to our platform that will revolutionize how you [user benefit].
                    </p>

                    <div style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); padding: 24px; border-radius: 16px; margin: 24px 0; text-align: center;">
                        <h3 style="color: #7c3aed; margin: 0 0 8px 0; font-size: 20px;">âœ¨ [Feature Name]</h3>
                        <p style="color: #6b21a8; margin: 0; font-size: 15px;">Brief tagline describing the feature's main benefit</p>
                    </div>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">Why We Built This</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        After listening to feedback from thousands of users, we identified a common pain point: [user problem]. Our new feature directly addresses this by [solution approach].
                    </p>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">Key Capabilities</h2>
                    <ul style="color: #475569; font-size: 16px; line-height: 2; padding-left: 24px;">
                        <li><strong>Capability 1:</strong> Description of what it does and why it matters</li>
                        <li><strong>Capability 2:</strong> Description of what it does and why it matters</li>
                        <li><strong>Capability 3:</strong> Description of what it does and why it matters</li>
                    </ul>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">How to Get Started</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        Getting started with [Feature Name] is easy:
                    </p>
                    <ol style="color: #475569; font-size: 16px; line-height: 2; padding-left: 24px;">
                        <li>Navigate to [location in app]</li>
                        <li>Click on [button/action]</li>
                        <li>Configure your [settings] and you're ready to go!</li>
                    </ol>

                    <div style="background: #1e293b; color: white; padding: 24px; border-radius: 12px; margin: 24px 0; text-align: center;">
                        <p style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Ready to try [Feature Name]?</p>
                        <a href="#" style="display: inline-block; background: #8b5cf6; color: white; padding: 12px 28px; border-radius: 10px; text-decoration: none; font-weight: 600;">Try It Now â†’</a>
                    </div>
                `
            },
            {
                id: 'company-news',
                name: 'Company News',
                description: 'Share announcements and updates',
                icon: 'campaign',
                iconBg: 'bg-amber-500/20',
                iconColor: 'text-amber-500',
                title: '[Announcement Type]: [Exciting News Headline]',
                excerpt: 'Big news from our team that marks an important milestone in our journey.',
                category: 'Company',
                content: `
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        We're delighted to share some exciting news with our community. [Brief introduction to the announcement and why it matters].
                    </p>

                    <div style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); padding: 24px; border-radius: 16px; margin: 24px 0;">
                        <h3 style="color: #b45309; margin: 0 0 12px 0; font-size: 18px;">ðŸŽ‰ The Big Announcement</h3>
                        <p style="color: #92400e; margin: 0; font-size: 16px;">[Clear, concise statement of the main announcement]</p>
                    </div>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">What This Means</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        This announcement represents [significance]. For our customers and partners, this means [direct impact and benefits].
                    </p>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">Our Journey</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        Looking back at how far we've come, this milestone is particularly meaningful. [Brief reflection on the journey and gratitude].
                    </p>

                    <h2 style="color: #1e293b; margin: 28px 0 16px 0; font-size: 24px;">What's Next</h2>
                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        This is just the beginning. In the coming months, you can expect [preview of future plans]. We're more committed than ever to [mission/goal].
                    </p>

                    <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 28px 0;">

                    <p style="font-size: 16px; line-height: 1.8; color: #475569;">
                        Thank you for being part of our journey. Your support and feedback continue to drive us forward. If you have any questions or just want to say hello, don't hesitate to reach out.
                    </p>
                    <p style="font-size: 16px; color: #475569;">
                        â€” The [Company Name] Team ðŸ’›
                    </p>
                `
            }
        ];

        let selectedTemplate = null;

        function renderTemplates() {
            const grid = document.getElementById('template-grid');
            grid.innerHTML = articleTemplates.map(template => `
                <div class="template-card bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden ${selectedTemplate?.id === template.id ? 'selected' : ''}"
                    onclick="selectTemplate('${template.id}')">
                    <div class="template-preview h-36 relative ${template.id === 'blank' ? 'flex items-center justify-center' : ''}">
                        ${template.id === 'blank' ? `
                            <div class="flex flex-col items-center text-slate-400">
                                <span class="material-symbols-outlined text-4xl mb-2">add</span>
                                <span class="text-sm font-medium">Start Fresh</span>
                            </div>
                        ` : `
                            <div class="p-3 overflow-hidden h-full">
                                <div class="template-preview-content text-slate-700 dark:text-slate-300">${template.content}</div>
                            </div>
                        `}
                    </div>
                    <div class="p-4 border-t border-slate-100 dark:border-slate-700">
                        <div class="flex items-center gap-3">
                            <div class="size-10 rounded-lg ${template.iconBg} flex items-center justify-center flex-shrink-0">
                                <span class="material-symbols-outlined ${template.iconColor}">${template.icon}</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-semibold text-slate-900 dark:text-white text-sm">${template.name}</h4>
                                <p class="text-xs text-slate-500 truncate">${template.description}</p>
                            </div>
                            ${selectedTemplate?.id === template.id ? `
                                <span class="material-symbols-outlined text-primary">check_circle</span>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        window.selectTemplate = function (templateId) {
            selectedTemplate = articleTemplates.find(t => t.id === templateId);
            renderTemplates();
            document.getElementById('preview-template-btn').disabled = !selectedTemplate;
            document.getElementById('use-template-btn').disabled = !selectedTemplate;
        };

        window.openTemplateModal = function () {
            selectedTemplate = null;
            renderTemplates();
            document.getElementById('preview-template-btn').disabled = true;
            document.getElementById('use-template-btn').disabled = true;
            document.getElementById('template-modal').classList.remove('hidden');
        };

        window.closeTemplateModal = function () {
            document.getElementById('template-modal').classList.add('hidden');
        };

        window.previewSelectedTemplate = function () {
            if (!selectedTemplate) return;
            document.getElementById('template-preview-title').textContent = selectedTemplate.name + ' Preview';
            document.getElementById('template-preview-content').innerHTML = `
                <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400 mb-4">${selectedTemplate.category}</span>
                <h1 class="text-2xl font-bold text-slate-900 dark:text-white mb-3">${selectedTemplate.title || 'Your Article Title'}</h1>
                <p class="text-slate-500 mb-6 italic">${selectedTemplate.excerpt || 'Your article excerpt will appear here...'}</p>
                <hr class="border-slate-200 dark:border-slate-700 mb-6">
                <div class="prose dark:prose-invert max-w-none">${selectedTemplate.content || '<p class="text-slate-400 italic">Empty template - start with your own content!</p>'}</div>
            `;
            document.getElementById('template-preview-modal').classList.remove('hidden');
        };

        window.closeTemplatePreview = function () {
            document.getElementById('template-preview-modal').classList.add('hidden');
        };

        window.useSelectedTemplate = function () {
            if (!selectedTemplate) return;
            closeTemplateModal();
            document.getElementById('article-form').reset();
            document.getElementById('article-id').value = '';
            document.getElementById('modal-title').textContent = 'Write New Article';
            document.getElementById('article-title').value = selectedTemplate.title || '';
            document.getElementById('article-excerpt').value = selectedTemplate.excerpt || '';
            document.getElementById('article-category').value = selectedTemplate.category || 'Technology';
            quill.root.innerHTML = selectedTemplate.content || '';
            document.getElementById('compose-modal').classList.remove('hidden');
        };

        window.useTemplateFromPreview = function () {
            closeTemplatePreview();
            useSelectedTemplate();
        };

        function showToast(msg, type = 'success') { const t = document.getElementById('toast'); document.getElementById('toast-icon').textContent = type === 'success' ? 'check_circle' : 'error'; document.getElementById('toast-message').textContent = msg; t.classList.remove('translate-y-20', 'opacity-0'); t.classList.add('translate-y-0', 'opacity-100'); setTimeout(() => { t.classList.remove('translate-y-0', 'opacity-100'); t.classList.add('translate-y-20', 'opacity-0'); }, 3000); }

        document.addEventListener('DOMContentLoaded', () => { initEditor(); loadArticles(); });
    </script>
</body>

</html>