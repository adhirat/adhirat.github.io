<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Blog Articles - Adhirat Portal</title>
    <meta name="robots" content="noindex, nofollow">
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <script src="../assets/js/app.js"></script>
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <style>
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
        }

        .ql-toolbar.ql-snow {
            border: none !important;
            background: rgba(148, 163, 184, 0.1);
            border-radius: 12px 12px 0 0;
            padding: 12px !important;
        }

        .dark .ql-toolbar.ql-snow {
            background: rgba(30, 41, 59, 0.8);
        }

        .ql-container.ql-snow {
            border: none !important;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
        }

        .ql-editor {
            min-height: 350px;
            padding: 24px !important;
            color: #1e293b;
            line-height: 1.8;
        }

        .dark .ql-editor {
            color: #e2e8f0;
        }

        .ql-editor.ql-blank::before {
            color: #94a3b8;
            font-style: normal !important;
        }

        .ql-toolbar .ql-stroke {
            stroke: #64748b !important;
        }

        .dark .ql-toolbar .ql-stroke {
            stroke: #94a3b8 !important;
        }

        .ql-toolbar .ql-fill {
            fill: #64748b !important;
        }

        .dark .ql-toolbar .ql-fill {
            fill: #94a3b8 !important;
        }

        .ql-toolbar .ql-picker-label {
            color: #64748b !important;
        }

        .dark .ql-toolbar .ql-picker-label {
            color: #94a3b8 !important;
        }

        .ql-toolbar button:hover .ql-stroke,
        .ql-toolbar button.ql-active .ql-stroke {
            stroke: var(--primary) !important;
        }

        .ql-picker-options {
            background: white !important;
            border: 1px solid #e2e8f0 !important;
            border-radius: 8px !important;
        }

        .dark .ql-picker-options {
            background: #1e293b !important;
            border-color: #334155 !important;
        }

        .article-card {
            transition: all 0.3s ease;
        }

        .article-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .stats-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .dark .stats-card {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(0, 245, 255, 0.2);
        }

        .category-badge {
            transition: all 0.2s ease;
        }

        .category-badge:hover {
            transform: scale(1.05);
        }
    </style>
</head>

<body
    class="pt-0 bg-background-light dark:bg-dark-bg text-slate-900 dark:text-white font-display antialiased overflow-hidden">
    <div class="flex h-screen w-full overflow-hidden">
        <div id="portal-sidebar" class="contents"></div>
        <main class="flex-1 flex flex-col min-w-0">
            <div id="portal-header" class="contents"></div>
            <div class="flex-1 overflow-y-auto p-4 sm:p-8 animate-fade-in-up">
                <div class="max-w-[1400px] mx-auto flex flex-col gap-8">
                    <!-- Header -->
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                        <div>
                            <h1 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white">Blog Articles
                            </h1>
                            <p class="text-slate-500 dark:text-slate-400">Create and manage blog posts for your website.
                            </p>
                        </div>
                        <button onclick="openComposeModal()"
                            class="px-6 py-3 rounded-xl bg-primary text-white font-bold flex items-center gap-2 hover:bg-blue-600 transition-all shadow-lg shadow-primary/25 group">
                            <span
                                class="material-symbols-outlined text-xl group-hover:rotate-12 transition-transform">edit_note</span>
                            Write Article
                        </button>
                    </div>

                    <!-- Stats -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="stats-card rounded-xl p-5 hover:scale-[1.02] transition-all">
                            <div class="flex items-center gap-4">
                                <div class="size-12 rounded-xl bg-primary/20 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-2xl text-primary">article</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-slate-900 dark:text-white" id="stats-total">0</p>
                                    <p class="text-sm text-slate-500">Total Articles</p>
                                </div>
                            </div>
                        </div>
                        <div class="stats-card rounded-xl p-5 hover:scale-[1.02] transition-all">
                            <div class="flex items-center gap-4">
                                <div class="size-12 rounded-xl bg-green-500/20 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-2xl text-green-500">public</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-slate-900 dark:text-white" id="stats-published">0
                                    </p>
                                    <p class="text-sm text-slate-500">Published</p>
                                </div>
                            </div>
                        </div>
                        <div class="stats-card rounded-xl p-5 hover:scale-[1.02] transition-all">
                            <div class="flex items-center gap-4">
                                <div class="size-12 rounded-xl bg-amber-500/20 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-2xl text-amber-500">edit</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-slate-900 dark:text-white" id="stats-drafts">0</p>
                                    <p class="text-sm text-slate-500">Drafts</p>
                                </div>
                            </div>
                        </div>
                        <div class="stats-card rounded-xl p-5 hover:scale-[1.02] transition-all">
                            <div class="flex items-center gap-4">
                                <div class="size-12 rounded-xl bg-purple-500/20 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-2xl text-purple-500">visibility</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-slate-900 dark:text-white" id="stats-views">0</p>
                                    <p class="text-sm text-slate-500">Total Views</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="flex flex-wrap gap-3">
                        <input type="text" id="search-input" placeholder="Search articles..." onkeyup="searchArticles()"
                            class="pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-primary w-64">
                        <select id="category-filter" onchange="filterArticles()"
                            class="px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm">
                            <option value="all">All Categories</option>
                            <option value="Technology">Technology</option>
                            <option value="Company">Company</option>
                            <option value="Industry">Industry</option>
                            <option value="Tutorials">Tutorials</option>
                        </select>
                        <select id="status-filter" onchange="filterArticles()"
                            class="px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm">
                            <option value="all">All Status</option>
                            <option value="published">Published</option>
                            <option value="draft">Drafts</option>
                        </select>
                    </div>

                    <!-- Articles Grid -->
                    <div id="articles-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="col-span-full py-12 text-center">
                            <div
                                class="size-8 mx-auto border-2 border-primary border-t-transparent rounded-full animate-spin">
                            </div>
                            <p class="text-slate-500 mt-3">Loading articles...</p>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div id="empty-state" class="hidden text-center py-16">
                        <div
                            class="size-20 mx-auto mb-4 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center">
                            <span class="material-symbols-outlined text-4xl text-slate-400">article</span>
                        </div>
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-2">No articles yet</h3>
                        <p class="text-slate-500 mb-6">Start creating content for your blog.</p>
                        <button onclick="openComposeModal()"
                            class="px-6 py-3 rounded-xl bg-primary text-white font-semibold hover:bg-blue-600">Write
                            Your First Article</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Compose Modal -->
    <div id="compose-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0" onclick="closeComposeModal()"></div>
        <div
            class="relative bg-white dark:bg-dark-card rounded-2xl shadow-2xl w-full max-w-5xl border border-slate-200 dark:border-slate-700 animate-fade-in-up flex flex-col max-h-[95vh]">
            <div
                class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center flex-shrink-0">
                <div>
                    <h2 id="modal-title" class="text-xl font-bold text-slate-900 dark:text-white">Write New Article</h2>
                    <p class="text-sm text-slate-500 mt-1">Create engaging content with the rich text editor</p>
                </div>
                <button onclick="closeComposeModal()"
                    class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl"><span
                        class="material-symbols-outlined">close</span></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <form id="article-form" class="space-y-6">
                    <input type="hidden" id="article-id" value="">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Article
                            Title</label>
                        <input type="text" id="article-title" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-xl font-bold focus:ring-2 focus:ring-primary"
                            placeholder="Enter a compelling title...">
                    </div>
                    <div>
                        <label
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Excerpt</label>
                        <textarea id="article-excerpt" rows="2"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary"
                            placeholder="Brief summary for previews..."></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label
                                class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Category</label>
                            <select id="article-category"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                                <option value="Technology">Technology</option>
                                <option value="Company">Company News</option>
                                <option value="Industry">Industry Insights</option>
                                <option value="Tutorials">Tutorials</option>
                            </select>
                        </div>
                        <div>
                            <label
                                class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Author</label>
                            <input type="text" id="article-author"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900"
                                placeholder="Author name">
                        </div>
                        <div>
                            <label
                                class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Tags</label>
                            <input type="text" id="article-tags"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900"
                                placeholder="AI, Cloud, SaaS">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Featured
                            Image URL</label>
                        <input type="url" id="article-image"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900"
                            placeholder="https://...">
                    </div>
                    <div>
                        <label
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2">Content</label>
                        <div
                            class="rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden bg-white dark:bg-slate-900">
                            <div id="editor-container"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div
                class="p-6 border-t border-slate-200 dark:border-slate-700 flex flex-wrap justify-end gap-3 flex-shrink-0 bg-slate-50/50 dark:bg-slate-900/50">
                <button onclick="closeComposeModal()"
                    class="px-5 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-800">Cancel</button>
                <button onclick="saveArticle('draft')"
                    class="px-5 py-2.5 rounded-xl bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-white hover:bg-slate-300 dark:hover:bg-slate-600 font-medium">Save
                    Draft</button>
                <button onclick="saveArticle('published')"
                    class="px-6 py-2.5 rounded-xl bg-primary text-white hover:bg-blue-600 shadow-lg shadow-primary/25 font-semibold flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">public</span>Publish
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="delete-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0" onclick="closeDeleteModal()"></div>
        <div
            class="relative bg-white dark:bg-dark-card rounded-2xl shadow-2xl max-w-md w-full border border-slate-200 dark:border-slate-700 animate-fade-in-up p-6 text-center">
            <div
                class="size-16 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                <span class="material-symbols-outlined text-3xl text-red-500">delete</span>
            </div>
            <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Delete Article?</h3>
            <p class="text-slate-500 mb-6">This action cannot be undone.</p>
            <div class="flex justify-center gap-3">
                <button onclick="closeDeleteModal()"
                    class="px-5 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-800">Cancel</button>
                <button onclick="confirmDelete()"
                    class="px-5 py-2.5 rounded-xl bg-red-500 text-white hover:bg-red-600 font-medium">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="fixed bottom-8 right-8 transform translate-y-20 opacity-0 transition-all duration-300 z-[100]">
        <div
            class="flex items-center gap-3 px-5 py-4 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-2xl">
            <span id="toast-icon" class="material-symbols-outlined"></span>
            <span id="toast-message" class="font-medium"></span>
        </div>
    </div>

    <script type="module">
        import { db, collection, addDoc, doc, getDoc, getDocs, deleteDoc, updateDoc, query, orderBy, serverTimestamp } from '../assets/js/firebase-config.js';
        import { initAuthObserver } from '../assets/js/firebase-modules.js';
        initAuthObserver(true);

        let quill, articles = [], deleteId = null;
        const categoryColors = { Technology: 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400', Company: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400', Industry: 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400', Tutorials: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' };

        function initEditor() {
            quill = new Quill('#editor-container', {
                theme: 'snow',
                modules: { toolbar: [[{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline', 'strike'], [{ 'color': [] }, { 'background': [] }], [{ 'list': 'ordered' }, { 'list': 'bullet' }], [{ 'align': [] }], ['link', 'image', 'video'], ['blockquote', 'code-block'], ['clean']] },
                placeholder: 'Write your article content here...'
            });
        }

        async function loadArticles() {
            try {
                const q = query(collection(db, "articles"), orderBy("createdAt", "desc"));
                const snapshot = await getDocs(q);
                articles = [];
                snapshot.forEach(doc => articles.push({ id: doc.id, ...doc.data() }));
                renderArticles(articles);
                updateStats();
            } catch (e) { console.error(e); showToast('Error loading articles', 'error'); }
        }

        function renderArticles(data) {
            const grid = document.getElementById('articles-grid');
            const empty = document.getElementById('empty-state');
            if (data.length === 0) { grid.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            grid.innerHTML = data.map(a => {
                const date = a.createdAt?.toDate ? new Date(a.createdAt.toDate()).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '-';
                const color = categoryColors[a.category] || categoryColors.Technology;
                const status = a.status === 'published' ? '<span class="size-2 rounded-full bg-green-500"></span> Published' : '<span class="size-2 rounded-full bg-amber-500"></span> Draft';
                return `<div class="article-card bg-white dark:bg-dark-card rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden">
                    <div class="aspect-video bg-slate-100 dark:bg-slate-800 relative overflow-hidden">
                        ${a.imageUrl ? `<img src="${a.imageUrl}" class="w-full h-full object-cover" alt="">` : `<div class="flex items-center justify-center h-full"><span class="material-symbols-outlined text-5xl text-slate-300">article</span></div>`}
                        <span class="absolute top-3 left-3 px-3 py-1 rounded-full text-xs font-semibold ${color} category-badge">${a.category || 'Uncategorized'}</span>
                    </div>
                    <div class="p-5">
                        <div class="flex items-center gap-2 text-xs text-slate-500 mb-2">${status} <span class="mx-1">â€¢</span> ${date}</div>
                        <h3 class="font-bold text-lg text-slate-900 dark:text-white mb-2 line-clamp-2">${a.title || 'Untitled'}</h3>
                        <p class="text-sm text-slate-500 line-clamp-2 mb-4">${a.excerpt || ''}</p>
                        <div class="flex items-center justify-between pt-4 border-t border-slate-100 dark:border-slate-700">
                            <span class="text-sm text-slate-500">${a.author || 'Unknown'}</span>
                            <div class="flex gap-1">
                                <button onclick="editArticle('${a.id}')" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg text-slate-500 hover:text-primary"><span class="material-symbols-outlined text-[20px]">edit</span></button>
                                <button onclick="openDeleteModal('${a.id}')" class="p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-slate-500 hover:text-red-500"><span class="material-symbols-outlined text-[20px]">delete</span></button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function updateStats() {
            document.getElementById('stats-total').textContent = articles.length;
            document.getElementById('stats-published').textContent = articles.filter(a => a.status === 'published').length;
            document.getElementById('stats-drafts').textContent = articles.filter(a => a.status === 'draft').length;
            document.getElementById('stats-views').textContent = articles.reduce((s, a) => s + (a.views || 0), 0);
        }

        window.saveArticle = async function (status) {
            const title = document.getElementById('article-title').value;
            if (!title.trim()) { showToast('Please enter a title', 'error'); return; }
            const data = { title, excerpt: document.getElementById('article-excerpt').value, category: document.getElementById('article-category').value, author: document.getElementById('article-author').value, tags: document.getElementById('article-tags').value, imageUrl: document.getElementById('article-image').value, content: quill.root.innerHTML, status, updatedAt: serverTimestamp() };
            const id = document.getElementById('article-id').value;
            try {
                if (id) await updateDoc(doc(db, "articles", id), data);
                else { data.createdAt = serverTimestamp(); data.views = 0; await addDoc(collection(db, "articles"), data); }
                showToast(status === 'published' ? 'Article published!' : 'Draft saved!', 'success');
                closeComposeModal(); loadArticles();
            } catch (e) { console.error(e); showToast('Error saving article', 'error'); }
        };

        window.editArticle = async function (id) {
            try {
                const snap = await getDoc(doc(db, "articles", id));
                if (snap.exists()) {
                    const d = snap.data();
                    document.getElementById('article-id').value = id;
                    document.getElementById('article-title').value = d.title || '';
                    document.getElementById('article-excerpt').value = d.excerpt || '';
                    document.getElementById('article-category').value = d.category || 'Technology';
                    document.getElementById('article-author').value = d.author || '';
                    document.getElementById('article-tags').value = d.tags || '';
                    document.getElementById('article-image').value = d.imageUrl || '';
                    quill.root.innerHTML = d.content || '';
                    document.getElementById('modal-title').textContent = 'Edit Article';
                    openComposeModal(true);
                }
            } catch (e) { console.error(e); showToast('Error loading article', 'error'); }
        };

        window.openDeleteModal = id => { deleteId = id; document.getElementById('delete-modal').classList.remove('hidden'); };
        window.closeDeleteModal = () => { deleteId = null; document.getElementById('delete-modal').classList.add('hidden'); };
        window.confirmDelete = async () => { if (!deleteId) return; try { await deleteDoc(doc(db, "articles", deleteId)); showToast('Article deleted', 'success'); closeDeleteModal(); loadArticles(); } catch (e) { showToast('Error', 'error'); } };
        window.openComposeModal = (isEdit = false) => { if (!isEdit) { document.getElementById('article-form').reset(); document.getElementById('article-id').value = ''; document.getElementById('modal-title').textContent = 'Write New Article'; quill.root.innerHTML = ''; } document.getElementById('compose-modal').classList.remove('hidden'); };
        window.closeComposeModal = () => document.getElementById('compose-modal').classList.add('hidden');
        window.searchArticles = () => { const q = document.getElementById('search-input').value.toLowerCase(); renderArticles(articles.filter(a => (a.title || '').toLowerCase().includes(q) || (a.excerpt || '').toLowerCase().includes(q))); };
        window.filterArticles = () => { const cat = document.getElementById('category-filter').value; const st = document.getElementById('status-filter').value; renderArticles(articles.filter(a => (cat === 'all' || a.category === cat) && (st === 'all' || a.status === st))); };

        function showToast(msg, type = 'success') { const t = document.getElementById('toast'); document.getElementById('toast-icon').textContent = type === 'success' ? 'check_circle' : 'error'; document.getElementById('toast-message').textContent = msg; t.classList.remove('translate-y-20', 'opacity-0'); t.classList.add('translate-y-0', 'opacity-100'); setTimeout(() => { t.classList.remove('translate-y-0', 'opacity-100'); t.classList.add('translate-y-20', 'opacity-0'); }, 3000); }

        document.addEventListener('DOMContentLoaded', () => { initEditor(); loadArticles(); });
    </script>
</body>

</html>